-- (목록) 전체 기간 + 객실 전체 
DROP VIEW ALLDATE_LIST

-- (목록) 오늘 + 객실 전체
DROP VIEW TODAY_LIST

-- (목록) 1주일 + 객실 전체
DROP VIEW WEEK_LIST

-- (목록) 1개월 + 객실 전체
DROP VIEW MONTH_LIST

-- (목록) 3개월 + 객실 전체
DROP VIEW "3MONTH_LIST"

-- (목록) 6개월 + 객실 전체
DROP VIEW "6MONTH_LIST"

-- (목록) 1년 + 객실 전체
DROP VIEW YEAR_LIST

-- (총액) 전체 기간 + 객실 전체 
DROP VIEW ALLDATE_TOTAL

-- (총액) 오늘 + 객실 전체 
DROP VIEW TODAY_TOTAL

-- (총액) 1주일 + 객실 전체 
DROP VIEW WEEK_TOTAL

-- (총액) 1개월 + 객실 전체 
DROP VIEW MONTH_TOTAL

-- (총액) 3개월 + 객실 전체 
DROP VIEW "3MONTH_TOTAL"

-- (총액) 6개월 + 객실 전체 
DROP VIEW "6MONTH_TOTAL"

-- (총액) 1년 + 객실 전체 
DROP VIEW YEAR_TOTAL

-- 객실 + 결제
CREATE OR REPLACE VIEW SALES_ROOM
AS
SELECT R.ROOM_RESDATE, R.ROOM_NAME, R.ROOM_POSSIBLE, P.PAYMENTDETAIL_PRICE ROOM_PRICE
FROM CAMP_ROOM R JOIN CAMP_PAYMENTDETAIL P ON R.ROOM_NO = P.PAYMENTDETAIL_ROOMNO WHERE R.ROOM_POSSIBLE = 1;

-- (통계) 전체 기간 + 객실 전체
CREATE OR REPLACE VIEW ALLDATE_CHART
AS
SELECT ROOM_NAME, SUM(ROOM_POSSIBLE) TOTAL_CNT , SUM(ROOM_PRICE) TOTAL_PRICE, ROUND(RATIO_TO_REPORT(SUM(ROOM_PRICE)) OVER(), 3) * 100 AS PRICE_RATE FROM SALES_ROOM  GROUP BY ROOM_NAME ORDER BY 1 ASC;

-- (통계) 오늘 + 객실 전체
CREATE OR REPLACE VIEW TODAY_CHART
AS
SELECT ROOM_NAME, SUM(ROOM_POSSIBLE) TOTAL_CNT , SUM(ROOM_PRICE) TOTAL_PRICE, ROUND(RATIO_TO_REPORT(SUM(ROOM_PRICE)) OVER(), 3) * 100 AS PRICE_RATE FROM SALES_ROOM WHERE ROOM_RESDATE = TO_CHAR(SYSDATE) GROUP BY ROOM_NAME ORDER BY 1 ASC;

-- (통계) 1주일 + 객실 전체
CREATE OR REPLACE VIEW WEEK_CHART
AS
SELECT ROOM_NAME, SUM(ROOM_POSSIBLE) TOTAL_CNT , SUM(ROOM_PRICE) TOTAL_PRICE, ROUND(RATIO_TO_REPORT(SUM(ROOM_PRICE)) OVER(), 3) * 100 AS PRICE_RATE FROM SALES_ROOM WHERE ROOM_RESDATE BETWEEN  TO_CHAR(SYSDATE-7) AND TO_CHAR(SYSDATE) GROUP BY ROOM_NAME ORDER BY 1 ASC;

-- (통계) 1개월 + 객실 전체
CREATE OR REPLACE VIEW MONTH_CHART
AS
SELECT ROOM_NAME, SUM(ROOM_POSSIBLE) TOTAL_CNT , SUM(ROOM_PRICE) TOTAL_PRICE, ROUND(RATIO_TO_REPORT(SUM(ROOM_PRICE)) OVER(), 3) * 100 AS PRICE_RATE FROM SALES_ROOM WHERE ROOM_RESDATE BETWEEN TO_CHAR(ADD_MONTHS(SYSDATE, -1)) AND TO_CHAR(SYSDATE) GROUP BY ROOM_NAME ORDER BY 1 ASC;

-- (통계) 3개월 + 객실 전체
CREATE OR REPLACE VIEW "3MONTH_CHART"
AS
SELECT ROOM_NAME, SUM(ROOM_POSSIBLE) TOTAL_CNT , SUM(ROOM_PRICE) TOTAL_PRICE, ROUND(RATIO_TO_REPORT(SUM(ROOM_PRICE)) OVER(), 3) * 100 AS PRICE_RATE FROM SALES_ROOM WHERE ROOM_RESDATE BETWEEN TO_CHAR(ADD_MONTHS(SYSDATE, -3)) AND TO_CHAR(SYSDATE) GROUP BY ROOM_NAME ORDER BY 1 ASC;

-- (통계) 6개월 + 객실 전체
CREATE OR REPLACE VIEW "6MONTH_CHART"
AS
SELECT ROOM_NAME, SUM(ROOM_POSSIBLE) TOTAL_CNT , SUM(ROOM_PRICE) TOTAL_PRICE, ROUND(RATIO_TO_REPORT(SUM(ROOM_PRICE)) OVER(), 3) * 100 AS PRICE_RATE FROM SALES_ROOM WHERE ROOM_RESDATE BETWEEN TO_CHAR(ADD_MONTHS(SYSDATE, -6)) AND TO_CHAR(SYSDATE) GROUP BY ROOM_NAME ORDER BY 1 ASC;

-- (통계) 1년 + 객실 전체
CREATE OR REPLACE VIEW YEAR_CHART
AS
SELECT ROOM_NAME, SUM(ROOM_POSSIBLE) TOTAL_CNT , SUM(ROOM_PRICE) TOTAL_PRICE, ROUND(RATIO_TO_REPORT(SUM(ROOM_PRICE)) OVER(), 3) * 100 AS PRICE_RATE FROM SALES_ROOM WHERE ROOM_RESDATE BETWEEN TO_CHAR(ADD_MONTHS(SYSDATE, -12)) AND TO_CHAR(SYSDATE) GROUP BY ROOM_NAME ORDER BY 1 ASC;

-- 회원 
CREATE OR REPLACE VIEW ROOM_VIEW
AS
SELECT  R.ROOM_NO, R.ROOM_NAME, R.ROOM_RESDATE, R.ROOM_POSSIBLE, D.PAYMENTDETAIL_PEOPLE, P.PAYMENT_PRICE, P.PAYMENT_ORDERDATE, P.PAYMENT_REQUEST, P.PAYMENT_MEMNO 
FROM CAMP_PAYMENTDETAIL D FULL OUTER JOIN CAMP_ROOM R ON D.PAYMENTDETAIL_ROOMNO = R.ROOM_NO FULL OUTER JOIN CAMP_PAYMENT P ON D.PAYMENTDETAIL_PAYMENTNO = P.PAYMENT_NO;

CREATE OR REPLACE VIEW PAYMENT_VIEW
AS
SELECT M.MEM_NAME, M.MEM_ID, M.MEM_EMAIL, M.MEM_PHONE, M.MEM_PWD, P.PAYMENT_NO, P.PAYMENT_PRICE, P.PAYMENT_ORDERDATE, P.PAYMENT_REQUEST
FROM CAMP_MEMBER M FULL OUTER JOIN CAMP_PAYMENT P ON M.MEMBER_NO = P.PAYMENT_MEMNO;

CREATE OR REPLACE VIEW RESERVE_ROOM
AS
SELECT R.ROOM_NO, R.ROOM_NAME, R.ROOM_RESDATE, R.ROOM_POSSIBLE, R.PAYMENTDETAIL_PEOPLE AS "ROOM_MPEOPLE", R.PAYMENT_PRICE AS "ROOM_PRICE", R.PAYMENT_ORDERDATE, R.PAYMENT_REQUEST, M.MEM_NAME, M.MEM_ID, M.MEM_EMAIL, M.MEM_PHONE FROM ROOM_VIEW R FULL OUTER JOIN CAMP_MEMBER M ON R.PAYMENT_MEMNO = M.MEMBER_NO;